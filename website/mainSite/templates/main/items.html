{% extends "main/base.html" %}
{% load static %}

{% block css %}
  <link rel="stylesheet" href="{% static "main/css/normalize.css" %}">
  <link rel="stylesheet" href="{% static "main/css/base.css" %}">
  <link rel="stylesheet" href="{% static "main/css/items.css" %}">
  <link rel="stylesheet" href="{% static "main/css/user-avatar.css" %}">
{% endblock css %}

{% block script %}
  <script src="{% static "main/js/base.js" %}"></script>
  <script src="{% static "main/js/items.js" %}"></script>
{% endblock script %}

{% block header_nav %}
  {% include "main/partials/header_nav.html" %}
{% endblock header_nav %}

{% block sidebar_nav %}
  {% include "main/partials/header_nav.html" %}
{% endblock sidebar_nav %}

{% block auth_header_profile_url %}
  {% include "main/partials/auth_profile_url_block.html" %} 
{% endblock auth_header_profile_url %}

{% block not_auth_header_profile_url %}
  <a class="auth-btn" href="{% url "authPage" %}">Войти</a>
{% endblock not_auth_header_profile_url %}

{% block auth_sidebar_profile_url %}
  {% include "main/partials/auth_profile_url_block.html" %} 
{% endblock auth_sidebar_profile_url %}

{% block not_auth_sidebar_profile_url %}
  <a class="auth-btn" href="{% url "authPage" %}">Войти</a>
{% endblock not_auth_sidebar_profile_url %}

{% block main_content %}
  <div class="catalog-page">
    <!-- Фильтр -->
    <aside class="filter-sidebar">
      <h2 class="filter-title">Фильтр</h2>
      <form class="filter-form" id="filterForm">
        <div class="filter-group">
          <input
            type="text"
            class="filter-input"
            placeholder="Поиск по названию"
            name="title_search"
          />
        </div>

        <div class="filter-group">
          <label class="filter-label">Бюджет</label>
          <div class="range-inputs">
            <input
              type="text"
              class="filter-input"
              placeholder="От"
              name="budget_min"
            />
            <input
              type="text"
              class="filter-input"
              placeholder="До"
              name="budget_max"
            />
          </div>
        </div>

        <div class="filter-group">
          <label class="filter-label">Выручка</label>
          <div class="range-inputs">
            <input
              type="text"
              class="filter-input"
              placeholder="От"
              name="revenue_min"
            />
            <input
              type="text"
              class="filter-input"
              placeholder="До"
              name="revenue_max"
            />
          </div>
        </div>

        <div class="filter-group">
          <label class="filter-label">Год выхода</label>
          <div class="range-inputs">
            <input
              type="date"
              class="filter-input"
              name="release_date_min"
            />
            <input
              type="date"
              class="filter-input"
              name="release_date_max"
            />
          </div>
        </div>

        <div class="filter-group">
          <label class="filter-label">Продолжительность (мин)</label>
          <div class="range-inputs">
            <input
              type="text"
              class="filter-input"
              placeholder="От"
              name="duration_min"
            />
            <input
              type="text"
              class="filter-input"
              placeholder="До"
              name="duration_max"
            />
          </div>
        </div>

        <div class="filter-group">
          <div class="checkbox-group">
            <input type="checkbox" id="released" name="released" checked />
            <label for="released" class="filter-label">Уже вышел</label>
          </div>
        </div>

        <div class="filter-group">
          <label class="filter-label">Рейтинг</label>
          <div class="range-inputs">
            <input
              type="text"
              class="filter-input"
              placeholder="От"
              name="rating_min"
            />
            <input
              type="text"
              class="filter-input"
              placeholder="До"
              name="rating_max"
            />
          </div>
        </div>

        <div class="filter-group">
          <label class="filter-label">Жанры</label>
          <div class="select-wrapper">
            <select class="filter-select" name="genres" multiple>
              <option value="action">Боевик</option>
              <option value="comedy">Комедия</option>
              <option value="drama">Драма</option>
              <option value="fantasy">Фэнтези</option>
              <option value="horror">Ужасы</option>
              <option value="romance">Мелодрама</option>
              <option value="sci-fi">Фантастика</option>
              <option value="thriller">Триллер</option>
            </select>
          </div>
        </div>

        <button type="submit" class="submit-btn">Применить фильтры</button>
        <button type="button" class="reset-btn" id="resetFilters">
          Сбросить
        </button>
      </form>
    </aside>

    <!-- Контент -->
    <div class="content-area">
      <div class="content-header">
        {% if media_type == "films" %}
        <h1 class="page-title">Фильмы</h1>
        {% elif media_type == "serials" %}
        <h1 class="page-title">Сериалы</h1>
        {% elif media_type == "actors" %}
        <h1 class="page-title">Актеры</h1>
        {% endif %}
        <div class="sort-options">
          <span class="sort-label">Сортировка:</span>
          {% if media_type != "actors" %}
            <select class="sort-select" id="sortSelect">
              <option value="popular">По популярности</option>
              <option value="rating">По рейтингу</option>
              <option value="release_date">По дате выхода</option>
              <option value="title">По названию</option>
            </select>
          {% else %}
            <select class="sort-select" id="sortSelect">
              <option value="popular">По популярности</option>
              <option value="rating">По рейтингу</option>
              <option value="release_date">По дате рождения</option>
              <option value="title">По имени</option>
            </select>
          {% endif %}
        </div>
      </div>

      <div class="movies-grid" id="moviesGrid">
        {% for item in items %}       
          <a href="{% url 'itemPage' media_type item.search_id %}">
            <div class="movie-card">
              <div class="movie-poster">
                {% if item.local_img_path == "" %}
                  {% if media_type != "actors" %}
                    <i class="fas fa-film"></i>
                  {% else %}
                    <i class="fas fa-star"></i>
                  {% endif %}
                {% else %}
                    <img src="{{item.local_img_path.url}}" alt="{{ film.title }}">
                {% endif %}
              </div>
              <div class="movie-info">
                {% if media_type != "actors" %}
                  <h3 class="movie-title">{{item.title}}</h3>
                {% else %}
                  <h3 class="movie-title">{{item.name}}</h3>
                {% endif %}
                <div class="movie-meta">
                  {% if media_type == "films" %}
                    <span>{{item.release_date|date:"Y"}}</span>
                  {% elif media_type == "serials" %}
                    <span>{{item.first_air_date|date:"Y"}}-{{item.last_air_date|date:"Y"}}</span>
                  {% elif media_type == "actors" %}
                    <span>{{item.birthday}}</span>
                  {% endif %}
                  {% if media_type != "actors" %}
                    <span class="movie-rating">
                      <i class="fas fa-star"></i>
                      {{item.rating|floatformat:1}}
                    </span>
                  {% endif %}
                </div>
                {% if media_type != "actors" %}
                 <div class="movie-genres">
                  {% for genre in item.genres %}
                    <span class="genre-tag">{{genre.name}}</span>
                  {% endfor %}
                  </div>
                {% endif %}
              </div>
            </div>
          </a>
        {% endfor %}

      </div>
    </div>
  </div>
{% endblock main_content %}