{% extends "main/base.html" %}
{% load static %}

{% block css %}
  <link rel="stylesheet" href="{% static "main/css/normalize.css" %}">
  <link rel="stylesheet" href="{% static "main/css/base.css" %}">
  <link rel="stylesheet" href="{% static "main/css/search.css" %}">
{% endblock css %}

{% block script %}
  <script src="{% static "main/js/base.js" %}"></script>
  <script src="{% static "main/js/search.js" %}"></script>
{% endblock script %}

{% block header_nav %}
  <nav>
    <ul>
      <li><a href="{% url "mainPage" %}">Главная</a></li>
      <li><a href="{% url "filmsPage" %}">Фильмы</a></li>
      <li><a href="{% url "serialsPage" %}">Сериалы</a></li>
      <li><a href="{% url "actorsPage" %}">Актеры</a></li>
      {% if request.user.is_superuser %}
      <li><a href="{% url "adminPanel" %}">Админ панель</a></li>
      {% endif %}
    </ul>
  </nav>
{% endblock header_nav %}

{% block sidebar_nav %}
  <nav>
    <ul>
      <li><a href="{% url "mainPage" %}">Главная</a></li>
      <li><a href="{% url "filmsPage" %}">Фильмы</a></li>
      <li><a href="{% url "serialsPage" %}">Сериалы</a></li>
      <li><a href="{% url "actorsPage" %}">Актеры</a></li>
      {% if request.user.is_superuser %}
      <li><a href="{% url "adminPanel" %}">Админ панель</a></li>
      {% endif %}
    </ul>
  </nav>
{% endblock sidebar_nav %}

{% block auth_header_profile_url %}
  <a href="{% url "profilePage" %}">
    <div class="profile-block">
      <span>{{username}}</span>
      <div class="profile-icon">
        <i class="fa-solid fa-circle-user"></i>
      </div>
    </div>
  </a>
{% endblock auth_header_profile_url %}

{% block not_auth_header_profile_url %}
  <a class="auth-btn" href="{% url "authPage" %}">Войти</a>
{% endblock not_auth_header_profile_url %}

{% block auth_sidebar_profile_url %}
  <a href="{% url "profilePage" %}">
    <div class="profile-block">
      <span>{{username}}</span>
      <div class="profile-icon">
        <i class="fa-solid fa-circle-user"></i>
      </div>
    </div>
  </a>
{% endblock auth_sidebar_profile_url %}

{% block not_auth_sidebar_profile_url %}
  <a class="auth-btn" href="{% url "authPage" %}">Войти</a>
{% endblock not_auth_sidebar_profile_url %}

{% block main_content %}
  <div class="search-results-page">
  <div class="search-header">
    <a href="{% url "mainPage" %}" class="back-link">
      <i class="fas fa-arrow-left"></i>
      Назад на главную
    </a>

    <div class="search-info">
      <div>
        <h1 class="search-query">
          Результаты поиска: <span id="searchQuery">{{search_title}}</span>
        </h1>
        <p class="results-count">
          Найдено <span id="resultsCount">{{results_count}}</span> результатов
        </p>
      </div>

      <div class="sort-options">
        <span class="sort-label">Сортировка:</span>
        <select class="sort-select" id="sortSelect">
          <option value="rating">По рейтингу</option>
          <option value="release_date">По дате выхода</option>
          <option value="title">По названию</option>
        </select>
      </div>
    </div>
  </div>
  {% if results_count != 0 %}  
    <div class="content-grid" id="searchResults">
      {% if films|length > 0 %}
        {% for film in films %}
        
          <a href="{% url "itemPage" types.film film.search_id %}">
            <div class="movie-card">
              <div class="movie-poster">
                {% if film.local_img_path == "" %}
                  <i class="fas fa-film"></i>
                {% else %}
                  <img src="{{film.local_img_path.url}}" alt="{{ film.title }}">
                {% endif %}
              </div>
              <div class="movie-info">
                <h3 class="movie-title">{{film.title}}</h3>
                <div class="movie-meta">
                  <span>{{film.release_date}}</span>
                  <span class="movie-rating">
                    <i class="fas fa-star"></i>
                    {{film.rating}}
                  </span>
                </div>
                <div class="movie-genres">
                  {% for genre in film.genres %}
                    <span class="genre-tag">{{genre.name}}</span>
                  {% endfor %}
                </div>
              </div>
            </div>
          </a>
        {% endfor %}
      {% endif %}

      {% if serials|length > 0 %}
        {% for serial in serials %}
        
          <a href="{% url "itemPage" types.serial serial.search_id %}">
            <div class="movie-card">
              <div class="movie-poster">
                {% if serial.local_img_path == "" %}
                  <i class="fas fa-film"></i>
                {% else %}
                  <img src="{{serial.local_img_path.url}}" alt="{{ serial.title }}">
                {% endif %}
              </div>
              <div class="movie-info">
                <h3 class="movie-title">{{serial.title}}</h3>
                <div class="movie-meta">
                  <span>{{serial.release_date}}</span>
                  <span class="movie-rating">
                    <i class="fas fa-star"></i>
                    {{serial.rating}}
                  </span>
                </div>
                <div class="movie-genres">
                  {% for genre in serial.genres %}
                    <span class="genre-tag">{{genre.name}}</span>
                  {% endfor %}
                </div>
              </div>
            </div>
          </a>
        {% endfor %}
      {% endif %}

      {% if actors|length > 0 %}
        {% for actor in actors %}
          <a href="{% url "itemPage" types.actor actor.search_id %}">
            <div class="movie-card">
              <div class="movie-poster">
                {% if actor.local_img_path == "" %}
                  <i class="fas fa-film"></i>
                {% else %}
                  <img src="{{actor.local_img_path.url}}" alt="{{ actor.name }}">
                {% endif %}
              </div>
              <div class="movie-info">
                <h3 class="movie-title">{{actor.name}}</h3>
                <div class="movie-meta">
                  <span>{{actor.birthday}}</span>
                </div>
              </div>
            </div>
          </a>
        {% endfor %}
      {% endif %}
    </div>
  {% else %}
    <div class="no-results" id="noResults">
      <div class="no-results-icon">
        <i class="fas fa-search"></i>
      </div>
      <p class="no-results-text">По вашему запросу ничего не найдено</p>
      <p>Попробуйте изменить поисковый запрос или проверьте правописание</p>
    </div>
  {% endif %}

{% endblock main_content %}